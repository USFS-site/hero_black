<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hero (iframe)</title>

  <!-- Plus Jakarta Sans -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- PapaParse (robust CSV parsing) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root {
      --hero-height: 540px;
      --max-width: 1180px;
      --title-size: 48px;
      --accent-red: #e03b2b;
      --white: #ffffff;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: "Plus Jakarta Sans", arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: #fff;
    }

    /* Make the iframe's intrinsic height match the hero */
    body { height: var(--hero-height); overflow: hidden; }

    .hero {
      position: relative;
      width: 100%;
      height: var(--hero-height);
      overflow: hidden;
      display:flex;
      align-items:stretch;
      justify-content:flex-start;
      box-sizing: border-box;
      color: var(--white);
    }

    /* Background image */
    .hero__bg{
      position:absolute;
      inset:0;
      background-position: right center;
      background-size: cover;
      background-repeat: no-repeat;
      z-index:0;
      transform-origin:center;
    }

    /* Left->right heavy black gradient to transparent (matches screenshot) */
    .hero__overlay{
      position:absolute;
      inset:0;
      z-index:1;
      background: linear-gradient(90deg, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.6) 28%, rgba(0,0,0,0.25) 50%, rgba(0,0,0,0.0) 100%);
    }

    /* Content column */
    .hero__content {
      position: relative;
      z-index:2;
      display:flex;
      flex-direction:column;
      justify-content:center;
      height:100%;
      padding: 56px 32px;
      box-sizing:border-box;
      max-width: var(--max-width);
      margin-left: 40px;
    }

    .hero__inner { max-width: 720px; }

    /* Eyebrow (optional small label) */
    .hero__eyebrow {
      font-size: 14px;
      font-weight: 600;
      color: rgba(255,255,255,0.95);
      margin-bottom: 8px;
      letter-spacing: 0.02em;
    }

    /* Title: EXACT styles you provided + uppercase forced */
    .hero__title {
      font-family: "Plus Jakarta Sans", arial, sans-serif;
      font-size: var(--title-size);
      font-weight: 800;
      font-style: italic;
      line-height: 150%;
      color: #fff;
      margin: 0 0 24px 0;
      text-transform: uppercase; /* force uppercase per your choice */
      letter-spacing: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-shadow: 0 2px 6px rgba(0,0,0,0.25); /* soft shadow similar to screenshot */
    }

    /* Blurb: "font: 1rem/1.5 'Plus Jakarta Sans',arial,sans-serif;" */
    .hero__blurb {
      font: 1rem/1.5 "Plus Jakarta Sans", arial, sans-serif;
      color: rgba(255,255,255,0.95);
      margin: 0 0 20px 0;
      max-width: 60ch;
      white-space: normal;
    }

    .hero__buttons {
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 12px 20px;
      min-height:44px;
      border-radius:8px;
      font-weight:700;
      text-decoration:none;
      box-sizing:border-box;
      cursor:pointer;
      line-height:1;
    }

    .btn--primary {
      background: linear-gradient(180deg, var(--accent-red), #c93a30);
      color: #fff;
      border: none;
      box-shadow: 0 6px 18px rgba(224,59,43,0.18);
    }

    .btn--outline {
      background: transparent;
      color: #fff;
      border: 2px solid rgba(255,255,255,0.9);
    }

    /* Responsive tweaks */
    @media (max-width: 920px) {
      :root { --hero-height: 480px; }
      .hero__content { margin-left: 18px; padding: 36px 24px; }
    }

    @media (max-width: 640px) {
      :root { --hero-height: 520px; }
      .hero { align-items:flex-end; }
      .hero__content { padding: 28px 20px; margin-left: 12px; }
      .hero__title { font-size: 38px; }
      .hero__blurb { font-size: 15px; }
    }

    /* Fallback */
    .hero__fallback {
      display:none;
      align-items:center;
      justify-content:center;
      width:100%;
      height:100%;
      background:#222;
      color:#fff;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="hero" role="region" aria-label="Hero">
      <div id="bg" class="hero__bg" aria-hidden="true"></div>
      <div class="hero__overlay" aria-hidden="true"></div>

      <div class="hero__content">
        <div class="hero__inner">
          <div id="eyebrow" class="hero__eyebrow" style="display:none"></div>
          <h1 id="title" class="hero__title">Loading…</h1>
          <div id="blurb" class="hero__blurb"></div>
          <div id="buttons" class="hero__buttons"></div>
        </div>
      </div>
    </div>

    <div id="fallback" class="hero__fallback" style="display:none;">
      Content not available.
    </div>
  </div>

<script>
/*
  Usage:
    - Upload this file to GitHub Pages.
    - Embed in Sidearm by placing only the URL in the iframe field:
        https://yourgithub.io/hero_iframe.html?id=1
    - Optional query params:
        ?csvUrl=...    (use this to override the default CSV)
        ?id=1          (row id to select)
*/

// DEFAULT CSV (your published sheet CSV)
const DEFAULT_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRo6JAV5prsmpxnt6fl9BHXvaL25XD-hzRAyUe50rx4_ImrfjUjhjqKW72XW1QX2gRJwH6A3YXtTgmg/pub?output=csv";

// Default background -> use the uploaded screenshot path (we'll transform this to a URL in your deploy pipeline)
const DEFAULT_BG = "/mnt/data/Screenshot 2025-11-24 at 1.55.36 PM.png";

function qs() {
  const out = {};
  location.search.replace(/^\?/, '').split('&').forEach(p => {
    if(!p) return;
    const [k,v] = p.split('=').map(decodeURIComponent);
    out[k] = v===undefined ? '' : v;
  });
  return out;
}

function showFallback(){
  document.querySelector('.hero').style.display = 'none';
  document.getElementById('fallback').style.display = 'flex';
}

function safeText(str){
  return (str===null || str===undefined) ? '' : String(str);
}

(function init(){
  const params = qs();
  const csvUrl = params.csvUrl || DEFAULT_CSV;
  const targetId = params.id || params.row || null;
  console.log("Target ID:", targetId);
  console.log("CSV URL:", csvUrl);

  // Fetch CSV and parse with PapaParse
  fetch(csvUrl, {cache: 'no-cache'}).then(resp => {
    console.log("Fetched CSV, status:", resp.status);
    if(!resp.ok) throw new Error('CSV fetch returned ' + resp.status);
    return resp.text();
  }).then(csvText => {
    console.log("CSV text (first 300 chars):", csvText ? csvText.substring(0,300) : '(empty)');
    const parsed = Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      transformHeader: h => (h || '').trim()
    });

    if(!parsed || !parsed.data || parsed.data.length === 0) {
      console.warn("No rows parsed from CSV.");
      showFallback();
      return;
    }

    console.log("Parsed rows (first 3):", parsed.data.slice(0,3));

    // If targetId provided, find row where id matches (string compare, trimmed)
    let selected = null;
    if(targetId) {
      const t = String(targetId).trim();
      selected = parsed.data.find(r => {
        const candidate = (r.id || r.ID || r.Id || '').toString().trim();
        return candidate === t;
      });
    }
    if(!selected) selected = parsed.data[0]; // fallback to first row
    console.log("Selected row:", selected);

    if(!selected) { showFallback(); return; }

    // Map fields (user-specified header names: id, title, blurb, bg_image, button1_text, button1_url, button2_text, button2_url)
    const title = safeText(selected.title || selected.Title || '');
    const eyebrow = safeText(selected.eyebrow || selected.Eyebrow || selected.id || '');
    const blurb = safeText(selected.blurb || selected.Blurb || '');
    const bg = safeText(selected.bg_image || selected.bgImage || selected.background || '');
    const b1_text = safeText(selected.button1_text || selected.button1 || selected.cta1_text || '');
    const b1_url  = safeText(selected.button1_url || selected.button1link || selected.cta1_url || '');
    const b2_text = safeText(selected.button2_text || selected.button2 || selected.cta2_text || '');
    const b2_url  = safeText(selected.button2_url || selected.button2link || selected.cta2_url || '');

    // Apply DOM values (ID is never shown)
    const eyebrowEl = document.getElementById('eyebrow');
    if(eyebrow && eyebrow.trim() !== '') {
      eyebrowEl.style.display = 'block';
      eyebrowEl.textContent = eyebrow;
    } else {
      eyebrowEl.style.display = 'none';
    }

    // Title - force uppercase via CSS; insert raw text from sheet
    document.getElementById('title').textContent = title || '';

    // Blurb - allow minimal inline HTML (basic tags) by sanitizing: keep text only to be safe
    // (If you need HTML allowed, we can add a small sanitizer and permit <strong>, <em>, <a>)
    document.getElementById('blurb').textContent = blurb || '';

    // Background image - priority: sheet value -> default screenshot
    const bgFinal = (bg && bg.trim()) ? bg.trim() : DEFAULT_BG;
    document.getElementById('bg').style.backgroundImage = `url("${bgFinal}")`;

    // Buttons
    const btnWrap = document.getElementById('buttons');
    btnWrap.innerHTML = '';
    if(b1_text){
      const a = document.createElement('a');
      a.className = 'btn btn--primary';
      a.href = b1_url && b1_url.trim() ? b1_url : '#';
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = b1_text;
      btnWrap.appendChild(a);
    }
    if(b2_text){
      const a = document.createElement('a');
      a.className = 'btn btn--outline';
      a.href = b2_url && b2_url.trim() ? b2_url : '#';
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = b2_text;
      btnWrap.appendChild(a);
    }
  }).catch(err => {
    console.error("CSV load/parse error:", err);
    // Fallback sample content so something displays instead of blank page
    const sample = {
      title: "MEMBERSHIP",
      blurb: "Whether you're stepping onto the ice for the first time, supporting a skater, coaching, officiating, or leading a club — there's a place for you in U.S. Figure Skating.",
      bg_image: DEFAULT_BG,
      button1_text: "Join a Club",
      button1_url: "#join",
      button2_text: "Find a Club",
      button2_url: "#find"
    };
    document.getElementById('title').textContent = sample.title;
    document.getElementById('blurb').textContent = sample.blurb;
    document.getElementById('bg').style.backgroundImage = `url("${sample.bg_image}")`;

    const btnWrap = document.getElementById('buttons');
    btnWrap.innerHTML = '';
    const a1 = document.createElement('a');
    a1.className = 'btn btn--primary';
    a1.href = sample.button1_url;
    a1.textContent = sample.button1_text;
    btnWrap.appendChild(a1);
    const a2 = document.createElement('a');
    a2.className = 'btn btn--outline';
    a2.href = sample.button2_url;
    a2.textContent = sample.button2_text;
    btnWrap.appendChild(a2);
  });
})();
</script>
</body>
</html>
